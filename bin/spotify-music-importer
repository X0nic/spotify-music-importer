#! /usr/bin/env ruby

require 'thor'
require 'spotify/music/importer'

# options = {}
# OptionParser.new do |opts|
#   opts.banner = "Usage: import.rb [options]"
#
#   opts.on("-f", "--file FILENAME", "The filename to import") do |filename|
#     options[:filename] = filename
#   end
#
#   opts.on("-m", "--missing MISSING.json", "The output filename of bad matches") do |missing|
#     options[:missing] = missing
#   end
#
#   opts.on("-l", "--limit LIMIT", "Limit the number of lines to import") do |limit|
#     options[:limit] = limit.to_i
#   end
#
#   opts.on("-s", "--skip SKIP", "Skip the first X lines of import") do |skip|
#     options[:skip] = skip.to_i
#   end
#
#   opts.on("-t", "--access-token ACCESS_TOKEN", "Your access token to access the Spotify API. Find one here: https://developer.spotify.com/web-api/console/") do |token|
#     options[:access_token] = token
#   end
#
# end.parse!
#

class Spotify::Music::Importer::CLI < Thor
  option :filename, :required => true, :aliases => :f
  option :missing, :aliases => :m
  option :limit, :aliases => :l
  option :skip, :aliases => :s, :default => 0
  option :access_token, :required => true, :aliases => :t
  desc 'import', "Import your music library into spotify"
  def import
    importer = Spotify::Music::Importer::Processor.new
    importer.import(options[:filename], options)

    if options[:missing]
      File.open(options[:missing], 'w') do |f|
        puts "Writing to file #{options[:missing]}"
        f.write(JSON.pretty_generate(importer.missing))
      end
    end
  end
end

Spotify::Music::Importer::CLI.start
